# 要件定義書: 通知機能の実装

## 1. 概要

本ドキュメントは、「ラジオ体操フィットネスアプリ」における通知機能の実装に関する要件を定義する。
現在、UIコンポーネントのみが存在する通知機能を、ユーザーが設定した時刻にプッシュ通知を送信できるように完全に機能させることを目的とする。

## 2. ユーザーストーリー

- **ユーザーとして、** 毎日のラジオ体操を忘れないように、指定した時間にリマインダー（プッシュ通知）を受け取りたい。
- **ユーザーとして、** 不要なときには通知を簡単にオフにしたい。
- **ユーザーとして、** アプリを使用していないときでも通知を受け取りたい。

## 3. 機能要件

### 3.1. 通知の権限管理

- **FR-1: 通知権限の要求**
  - ユーザーが初めて通知設定を有効にしようとするとき、アプリケーションはブラウザを通じてプッシュ通知の許可を要求する。
- **FR-2: 権限状態の表示**
  - アプリケーションは、現在の通知権限の状態（許可、拒否、未設定）をUIに表示する。

### 3.2. 通知設定

- **FR-3: 通知の有効化/無効化**
  - ユーザーは、設定画面のトグルスイッチを使って、通知機能全体の有効/無効を切り替えることができる。
- **FR-4: 通知時刻の設定**
  - ユーザーは、時刻入力フィールドを使って、通知を受け取りたい時刻（時・分）を設定できる。

### 3.3. 通知のスケジュールと配信

- **FR-5: 通知のスケジュール**
  - ユーザーが通知を有効にし、時刻を設定すると、アプリケーションは指定された時刻に毎日通知をトリガーするようにスケジュールする。このスケジュールはService Workerを利用してバックグラウンドで管理される。
- **FR-6: 通知の表示**
  - スケジュールされた時刻になると、アプリケーションはService Workerを通じてプッシュ通知を表示する。
  - 通知には、アプリのアイコン、タイトル（例：「ラジオ体操の時間です！
」）、本文（例：「今日の体操を記録しましょう」）が含まれる。
- **FR-7: 通知クリック時の動作**
  - ユーザーが通知をクリックすると、アプリケーションがアクティブになり、ホーム画面が表示される。

## 4. 非機能要件

- **NFR-1: パフォーマンス**
  - 通知機能は、アプリケーションの起動時間やUIの応答性に悪影響を与えないこと。
- **NFR-2: オフライン対応**
  - 一度スケジュールされた通知は、デバイスがオフラインの場合でも指定された時刻にトリガーされること（Service Workerの標準的な動作）。
- **NFR-3: セキュリティ**
  - Service Workerの登録や通知のやり取りは、安全なコンテキスト（HTTPS）でのみ行われること。

## 5. 受入基準 (EARS形式)

- **AC-1: 通知権限の要求**
  - **もし** ユーザーが通知を無効にしており、 **かつ** 通知設定のトグルをオンにした **とき**、システムはユーザーにプッシュ通知の許可を求めるプロンプトを表示しなければならない。
- **AC-2: 通知の有効化**
  - **もし** ユーザーが通知権限を許可しており、 **かつ** 通知設定と時刻を設定して保存した **とき**、システムは指定された時刻に毎日通知をスケジュールしなければならない。
- **AC-3: 通知の無効化**
  - **もし** ユーザーが通知設定のトグルをオフにした **とき**、システムはスケジュールされているすべての通知をキャンセルしなければならない。
- **AC-4: 通知の受信**
  - **もし** 通知がスケジュールされており、 **かつ** 指定された時刻になった **とき**、システムは「ラジオ体操の時間です！」というタイトルのプッシュ通知を表示しなければならない。
- **AC-5: 通知からのアプリ起動**
  - **もし** ユーザーがプッシュ通知をクリックした **とき**、システムはアプリを起動し、ホーム画面を表示しなければならない。