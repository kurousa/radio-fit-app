# 実装計画

- [x] 1. タイムゾーン処理の基盤サービスを実装





  - TimezoneServiceクラスを作成し、ブラウザのIntl APIを使用してタイムゾーン検出・変換機能を実装
  - DateUtilsクラスを作成し、タイムゾーンを考慮した日付比較・計算機能を実装
  - エラーハンドリングとフォールバック機能を含める
  - _要件: 3.1, 4.1, 4.4_

- [x] 2. データモデルとインターフェースを拡張





  - ExerciseRecordインターフェースにタイムゾーン関連フィールドを追加
  - TimezoneInfo、CalendarDate等の新しい型定義を作成
  - 既存データとの互換性を保つためのマイグレーション関数を実装
  - _要件: 1.1, 1.2, 4.3_

- [ ] 3. RecordServiceをタイムゾーン対応に拡張
  - recordExerciseWithTimezone関数を実装し、タイムゾーン情報付きで記録を保存
  - getRecordsWithTimezoneConversion関数を実装し、指定タイムゾーンに変換して記録を取得
  - 既存のrecordExercise関数を内部的にタイムゾーン対応版を使用するよう更新
  - 既存データの自動マイグレーション機能を実装
  - _要件: 1.1, 1.2, 4.3_

- [ ] 4. ExercisesViewでタイムゾーン対応記録を実装
  - completeExercise関数を更新し、新しいタイムゾーン対応記録サービスを使用
  - 記録作成時にユーザーのローカルタイムゾーンを自動検出・保存
  - エラー時のユーザー通知機能を追加
  - _要件: 1.1, 3.1_

- [ ] 5. ProfileViewのカレンダー表示をタイムゾーン対応に更新
  - updateCalendarAttributes関数を更新し、ユーザーの現在タイムゾーンで記録を表示
  - カレンダー属性生成時にタイムゾーン変換を適用
  - ポップオーバーにローカル時刻情報を表示
  - _要件: 2.1, 2.3_

- [ ] 6. HomeViewの連続日数計算をタイムゾーン対応に更新
  - calculateStreak関数を更新し、タイムゾーンを考慮した日付比較を実装
  - DateUtilsのcalculateStreakWithTimezone関数を使用
  - 異なるタイムゾーンで作成された記録も正しく連続日数に反映
  - _要件: 2.3, 3.2_

- [ ] 7. システムタイムゾーン変更時の自動更新機能を実装
  - ブラウザのタイムゾーン変更を検出する仕組みを実装
  - タイムゾーン変更時にカレンダー表示を自動更新
  - 連続日数計算も自動で再計算
  - _要件: 2.2_

- [ ] 8. エラーハンドリングとユーザー通知システムを実装
  - TimezoneErrorHandlerクラスを実装
  - タイムゾーン検出失敗時のフォールバック処理
  - ユーザーへの適切なエラー通知機能
  - _要件: 4.4_

- [ ] 9. タイムゾーン機能の単体テストを作成
  - TimezoneServiceの各メソッドのテスト
  - DateUtilsの日付計算テスト
  - 異なるタイムゾーンでの変換精度テスト
  - サマータイム切り替え時のテスト
  - _要件: 3.3_

- [ ] 10. 統合テストとE2Eテストを作成
  - 記録作成から表示までの一連のフローテスト
  - タイムゾーン変更時の動作テスト
  - 既存データマイグレーションのテスト
  - _要件: 1.3, 2.1, 2.2, 2.3_